<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Ogre Smash Japanese</title>
<style>
    body {
        margin: 0;
        background: #d6ebff;
        display: flex;
        justify-content: center;
        padding-top: 20px;
    }
    canvas {
        background: linear-gradient(#cbe7ff, #e2ffe2);
        border-radius: 20px;
    }
</style>
</head>
<body>

<canvas id="gameCanvas" width="900" height="550"></canvas>

<!-- Sound -->
<audio id="clackSound" src="clack.mp3"></audio>

<script>
// =====================================
// Word List (Option B — Kanji + Hiragana, no parentheses)
// =====================================
const words = [
    ["cow", "牛", "うし"], ["horse", "馬", "うま"], ["fish", "魚", "さかな"],
    ["shell", "貝", "かい"], ["Japanese", "日本語", "にほんご"],
    ["Chinese", "中国語", "ちゅうごくご"], ["English", "英語", "えいご"],
    ["newspaper", "新聞", "しんぶん"], ["book", "本", "ほん"],
    ["weather", "天気", "てんき"], ["rain", "雨", "あめ"],
    ["magazine", "雑誌", "ざっし"], ["desk", "机", "つくえ"],
    ["chair", "椅子", "いす"], ["clock", "時計", "とけい"],
    ["cat", "猫", "ねこ"], ["dog", "犬", "いぬ"],
    ["bird", "鳥", "とり"]
];

// =====================================
// Canvas Setup
// =====================================
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const clackSound = document.getElementById("clackSound");

// Ogre sprite
const ogreImg = new Image();
ogreImg.src = "vecteezy_ogre.png";

const hammerImg = new Image();
hammerImg.src = "vecteezy_hammer.png";

// Ogre position
let ogre = {
    x: canvas.width / 2 - 100,
    y: canvas.height - 260
};

// =====================================
// Rocks Setup
// =====================================
let rocks = [];
const rockRadius = 70;

// Randomly pick a word
let currentWord = null;

function pickNewWord() {
    const pool = [...words];
    currentWord = pool[Math.floor(Math.random() * pool.length)];

    // correct answer:
    const correctKanji = currentWord[1];
    const correctHira = currentWord[2];

    // pick 3 other wrong answers
    const others = pool.filter(w => w !== currentWord)
                       .sort(() => Math.random() - 0.5)
                       .slice(0, 3);

    const options = [...others, currentWord].sort(() => Math.random() - 0.5);

    // place rocks
    rocks = options.map((w, i) => ({
        kanji: w[1],
        hira: w[2],
        x: 180 + i * 170,
        y: canvas.height - 100,
        radius: rockRadius,
        shake: 0,
        isCorrect: (w === currentWord)
    }));
}

// =====================================
// Draw Rocks
// =====================================
function drawRocks() {
    rocks.forEach(rock => {
        let offsetX = rock.shake !== 0 ? (Math.sin(Date.now() / 40) * 5) : 0;

        // rock shape
        ctx.fillStyle = "#ddd";
        ctx.beginPath();
        ctx.ellipse(rock.x + offsetX, rock.y, rock.radius, rock.radius * 0.6, 0, 0, Math.PI * 2);
        ctx.fill();

        // Kanji (big)
        ctx.fillStyle = "black";
        ctx.font = "bold 22px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText(rock.kanji, rock.x + offsetX, rock.y - 5);

        // Hiragana (small)
        ctx.font = "14px sans-serif";
        ctx.fillText(rock.hira, rock.x + offsetX, rock.y + 20);
    });
}

// =====================================
// Draw Ogre and Hammer
// =====================================
let hammerAngle = 0;    // 0 = up, positive = smash
let hammerSmashing = false;

function drawOgre() {
    // Ogre behind rocks
    ctx.drawImage(ogreImg, ogre.x, ogre.y, 220, 260);

    // Hammer (overlay)
    ctx.save();
    ctx.translate(ogre.x + 110, ogre.y + 130); // pivot point
    ctx.rotate(hammerAngle);
    ctx.drawImage(hammerImg, -20, -30, 120, 120);
    ctx.restore();
}

// =====================================
// Hammer Hit Detection
// =====================================
function checkHit() {
    // Hammer head position
    const hammerHitX = ogre.x + 160;
    const hammerHitY = ogre.y + 190;
    const hitRadius = 40;

    rocks.forEach(rock => {
        const dx = hammerHitX - rock.x;
        const dy = hammerHitY - rock.y;
        const dist = Math.sqrt(dx*dx + dy*dy);

        if (dist < hitRadius + rock.radius * 0.6) {
            if (rock.isCorrect) {
                clackSound.play();
                pickNewWord();
            } else {
                rock.shake = 8;
                setTimeout(() => rock.shake = 0, 350);
            }
        }
    });
}

// =====================================
// Animate Hammer
// =====================================
function smashHammer() {
    if (hammerSmashing) return;
    hammerSmashing = true;

    let step = 0;

    const smashInterval = setInterval(() => {
        step++;

        // swing down
        if (step < 6) hammerAngle += 0.25;
        // swing up
        else hammerAngle -= 0.25;

        if (step === 6) checkHit();

        if (step >= 12) {
            hammerAngle = 0;
            hammerSmashing = false;
            clearInterval(smashInterval);
        }
    }, 50);
}

// =====================================
// Mouse Click → Smash
// =====================================
canvas.addEventListener("click", smashHammer);

// =====================================
// Game Loop
// =====================================
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // English word on top
    ctx.fillStyle = "black";
    ctx.font = "32px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText(currentWord[0], canvas.width / 2, 60);

    // Draw in this order:
    drawOgre();   // behind
    drawRocks();  // in front

    requestAnimationFrame(gameLoop);
}

// =====================================
pickNewWord();
gameLoop();
// =====================================

</script>
</body>
</html>
