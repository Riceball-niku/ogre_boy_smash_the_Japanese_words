<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ogre Smash Game</title>

<style>
  body {
    margin:0;
    background:#e9f5ff;
    font-family: "Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
  }

  canvas {
    width:960px;
    max-width:98%;
    height:auto;
    background:linear-gradient(#bfe6ff,#e7f6ff);
    border-radius:10px;
    box-shadow:0 10px 25px rgba(0,0,0,0.12);
  }

  .hud {
    margin-top:10px;
    display:flex;
    align-items:center;
    gap:15px;
    width:960px;
    max-width:98%;
  }

  .btn {
    background:#2e8b57;
    color:white;
    padding:8px 12px;
    border:none;
    border-radius:7px;
    cursor:pointer;
  }

  .credit {
    font-size:13px;
    margin-top:8px;
    color:#444;
  }

  .center-msg {
    position:absolute;
    top:40%;
    left:50%;
    transform:translateX(-50%);
    background:white;
    padding:20px;
    border-radius:10px;
    box-shadow:0 10px 25px rgba(0,0,0,0.15);
    display:none;
    width:260px;
    text-align:center;
  }
</style>
</head>

<body>

<canvas id="game" width="960" height="600"></canvas>
<div id="endMessage" class="center-msg"></div>

<div class="hud">
  <div>Score: <strong id="score">0</strong></div>
  <div>Time: <strong id="time">60</strong>s</div>
  <button id="restart" class="btn">Restart</button>
  <div style="flex:1"></div>
  <div style="font-size:13px;color:#555;">Click a rock → Ogre walks & smashes.</div>
</div>

<div class="credit">Ogre + hammer images by Vecteezy</div>

<!-- Audio -->
<audio id="clack" src="clack.mp3" preload="auto"></audio>
<audio id="wrong" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

<script>
/* =======================
   WORD DATA
======================= */
const WORDS = [
  {english:"cow", kanji:"牛", kana:"うし"},
  {english:"horse", kanji:"馬", kana:"うま"},
  {english:"fish", kanji:"魚", kana:"さかな"},
  {english:"shell", kanji:"貝", kana:"かい"},
  {english:"Japanese", kanji:"日本語", kana:"にほんご"},
  {english:"Chinese", kanji:"中国語", kana:"ちゅうごくご"},
  {english:"English", kanji:"英語", kana:"えいご"},
  {english:"newspaper", kanji:"新聞", kana:"しんぶん"},
  {english:"book", kanji:"本", kana:"ほん"},
  {english:"weather", kanji:"天気", kana:"てんき"},
  {english:"rain", kanji:"雨", kana:"あめ"},
  {english:"magazine", kanji:"", kana:"ざっし"},
  {english:"desk", kanji:"", kana:"つくえ"},
  {english:"chair", kanji:"", kana:"いす"},
  {english:"clock", kanji:"時けい", kana:"とけい"},
  {english:"cat", kanji:"", kana:"ねこ"},
  {english:"dog", kanji:"犬", kana:"いぬ"},
  {english:"bird", kanji:"鳥", kana:"とり"}
];

/* =======================
   CANVAS SETUP
======================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const scoreEl = document.getElementById("score");
const timeEl = document.getElementById("time");
const restartBtn = document.getElementById("restart");
const endMsg = document.getElementById("endMessage");

const clack = document.getElementById("clack");
const wrong = document.getElementById("wrong");

/* =======================
   ASSETS (same folder)
======================= */
const ogreImg = new Image();
const hammerImg = new Image();
const rockImg = new Image();

ogreImg.src = "ogre.png";
hammerImg.src = "hammer.png";
rockImg.src = "rock.png";

/* =======================
   GAME STATE
======================= */
const START_X = 140;
const START_Y = 330;

let ogre = { x: START_X, y: START_Y, angle: -0.45 };
let targetWord = null;
let rocks = [];
let score = 0;

let moving = false;
let audioUnlocked = false;

/* =======================
   HELPERS
======================= */
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
}

function rand(n){ return Math.floor(Math.random()*n); }

/* =======================
   NEW ROUND
======================= */
function makeNewRound(){
  targetWord = WORDS[rand(WORDS.length)];

  const pool = WORDS.filter(w => w !== targetWord);
  shuffle(pool);
  const choices = [targetWord, ...pool.slice(0,3)];
  shuffle(choices);

  const left = 320;
  const right = 820;

  rocks = choices.map((w,i)=>({
    english:w.english,
    kanji:w.kanji,
    kana:w.kana,
    isCorrect:w===targetWord,
    x: left + i*((right-left)/3),
    y: 430,
    radiusX:70,
    radiusY:40,
    crack:0,
    shake:0
  }));
}

/* =======================
   DRAW
======================= */
function draw(){
  ctx.clearRect(0,0,960,600);

  // ground
  ctx.fillStyle = "#dbf0d6";
  ctx.fillRect(0,380,960,220);

  drawOgre();
  drawRocks();
  drawHammer();

  // English word
  ctx.fillStyle="#000";
  ctx.font="30px sans-serif";
  ctx.textAlign="center";
  if (targetWord)
    ctx.fillText(targetWord.english, 480, 50);
}

function drawOgre(){
  if (!ogreImg.complete) return;

  ctx.save();
  ctx.translate(ogre.x, ogre.y);
  ctx.drawImage(ogreImg, -110, -110, 220, 220);
  ctx.restore();
}

function drawHammer(){
  if (!hammerImg.complete) return;

  const pivotX = ogre.x + 65;
  const pivotY = ogre.y + 40;

  ctx.save();
  ctx.translate(pivotX, pivotY);
  ctx.rotate(ogre.angle);
  ctx.translate(-pivotX, -pivotY);
  ctx.drawImage(hammerImg, pivotX-60, pivotY-120, 150,150);
  ctx.restore();
}

function drawRocks(){
  rocks.forEach(r=>{
    const sx = (r.shake>0)? Math.sin(Date.now()/50)*3*r.shake : 0;

    // shadow
    ctx.fillStyle="rgba(0,0,0,0.15)";
    ctx.beginPath();
    ctx.ellipse(r.x+sx, r.y+20, r.radiusX, r.radiusY*0.7,0,0,Math.PI*2);
    ctx.fill();

    // rock
    ctx.drawImage(rockImg, r.x-80+sx, r.y-60, 160,120);

    // text
    ctx.fillStyle="#000";
    ctx.textAlign="center";

    if (r.kanji){
      ctx.font="28px 'Noto Sans JP'";
      ctx.fillText(r.kanji, r.x+sx, r.y-5);

      ctx.font="14px 'Noto Sans JP'";
      ctx.fillText(r.kana, r.x+sx, r.y+20);
    } else {
      ctx.font="26px 'Noto Sans JP'";
      ctx.fillText(r.kana, r.x+sx, r.y+8);
    }
  });
}

/* =======================
   MOVEMENT + SMASH
======================= */
function moveToRock(r){
  if (moving) return;
  moving = true;

  const start = performance.now();
  const from = ogre.x;
  const to = r.x - 40;
  const duration = 900;

  function anim(ts){
    let t = (ts - start)/duration;
    if (t>1) t=1;

    ogre.x = from + (to-from)*t;
    ogre.y = START_Y + Math.sin(t*Math.PI)*8;

    if (t<1){
      requestAnimationFrame(anim);
    } else {
      smash(r);
    }
  }
  requestAnimationFrame(anim);
}

function smash(r){
  const down = 300, up = 400;
  const t0 = performance.now();
  let played = false;

  function anim(){
    const now = performance.now();
    const t = now - t0;

    if (t < down){
      ogre.angle = -0.45 + (t/down)*1.2;
    }
    else if (t < down+up){
      ogre.angle = 0.75 - ((t-down)/up)*1.2;

      if (!played){
        played = true;

        if (r.isCorrect){
          clack.currentTime = 0;
          clack.play();
          score++;
          scoreEl.textContent = score;
          r.crack = 1;
        } else {
          wrong.currentTime = 0;
          wrong.play();
          r.shake = 1;
        }
      }
    }
    else {
      ogre.angle = -0.45;
      moving = false;

      if (r.isCorrect){
        setTimeout(makeNewRound, 500);
      }
      return;
    }
    requestAnimationFrame(anim);
  }
  requestAnimationFrame(anim);
}

/* =======================
   CLICK
======================= */
canvas.addEventListener("click", e=>{
  unlockAudio();

  const r = canvas.getBoundingClientRect();
  const mx = e.clientX - r.left;
  const my = e.clientY - r.top;

  for (const rock of rocks){
    const dx = mx - rock.x;
    const dy = my - rock.y;
    if ( (dx*dx)/(rock.radiusX*rock.radiusX) + (dy*dy)/(rock.radiusY*rock.radiusY) <= 1 ){
      moveToRock(rock);
      return;
    }
  }
});

/* =======================
   AUDIO UNLOCK FIX
======================= */
function unlockAudio(){
  if (audioUnlocked) return;
  clack.play().catch(()=>{});
  wrong.play().catch(()=>{});
  clack.pause(); wrong.pause();
  clack.currentTime=0; wrong.currentTime=0;
  audioUnlocked = true;
}

/* =======================
   TIMER
======================= */
let timeLeft = 60;
let timer = null;

function startGame(){
  score = 0;
  scoreEl.textContent = 0;
  timeLeft = 60;
  timeEl.textContent = 60;

  makeNewRound();

  if (timer) clearInterval(timer);
  timer = setInterval(()=>{
    timeLeft--;
    timeEl.textContent = timeLeft;
    if (timeLeft<=0){
      clearInterval(timer);
      endGame();
    }
  },1000);
}

function endGame(){
  endMsg.style.display="block";
  endMsg.innerHTML = `
    <h3>Time's Up!</h3>
    <p>Your score: <strong>${score}</strong></p>
    <button id="againBtn" class="btn">Play Again</button>
  `;
  document.getElementById("againBtn").onclick=()=>{
    endMsg.style.display="none";
    startGame();
  };
}

restartBtn.onclick = startGame;

/* =======================
   MAIN LOOP
======================= */
function loop(){
  draw();
  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
startGame();
</script>
</body>
</html>
